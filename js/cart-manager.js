class CartManager{constructor(){this.items=this.loadCart(),this.listeners=[]}loadCart(){try{const a=localStorage.getItem("delavilla_cart");return a?JSON.parse(a):[]}catch(a){return console.error("Error loading cart:",a),[]}}saveCart(){try{localStorage.setItem("delavilla_cart",JSON.stringify(this.items)),this.notifyListeners()}catch(a){console.error("Error saving cart:",a)}}addItem(a,b,c=1){const d=a.variants.find(a=>a.id===b);if(!d)throw new Error("Variant not found");if(!d.available)throw new Error("This item is out of stock");const e=this.items.find(a=>a.variantId===b);e?e.quantity+=c:this.items.push({productId:a.id,variantId:b,title:a.title,variantTitle:"Default Title"===d.title?null:d.title,price:d.price,image:a.images[0]?.url,quantity:c}),this.saveCart()}removeItem(a){this.items=this.items.filter(b=>b.variantId!==a),this.saveCart()}updateQuantity(a,b){const c=this.items.find(b=>b.variantId===a);c&&(0>=b?this.removeItem(a):(c.quantity=b,this.saveCart()))}getItems(){return this.items}getTotal(){return this.items.reduce((a,b)=>a+b.price*b.quantity,0)}getItemCount(){return this.items.reduce((a,b)=>a+b.quantity,0)}clear(){this.items=[],this.saveCart()}subscribe(a){this.listeners.push(a)}notifyListeners(){this.listeners.forEach(a=>a(this.items))}}